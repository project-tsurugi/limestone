syntax = "proto3";

package limestone.tpmonitor;

option java_multiple_files = true;
option java_package = "com.tsurugidb.limestone.tpmonitor";
option java_outer_classname = "TpMonitorProto";

message Participant {
  string ts_id = 1;
}

message CreateRequest {
  uint32 participant_count = 1;
}

message CreateResponse {
  bool ok = 1;
  uint64 tpm_id = 2;
  string message = 3;
}

message JoinRequest {
  uint64 tpm_id = 1;
  Participant participant = 2;
}

message JoinResponse {
  bool ok = 1;
  string message = 2;
}

message CreateAndJoinRequest {
  uint32 participant_count = 1;
  repeated Participant participants = 2;
}

message CreateAndJoinResponse {
  bool ok = 1;
  uint64 tpm_id = 2;
  string message = 3;
}

message DestroyRequest {
  uint64 tpm_id = 1;
}

message DestroyResponse {
  bool ok = 1;
  string message = 2;
}

message BarrierNotifyRequest {
  uint64 tpm_id = 1;
  string ts_id = 2;
}

message BarrierNotifyResponse {
  bool ok = 1;
  string message = 2;
}

service TpMonitorService {
  rpc Create(CreateRequest) returns (CreateResponse);
  rpc Join(JoinRequest) returns (JoinResponse);
  rpc CreateAndJoin(CreateAndJoinRequest) returns (CreateAndJoinResponse);
  rpc Destroy(DestroyRequest) returns (DestroyResponse);
  rpc BarrierNotify(BarrierNotifyRequest) returns (BarrierNotifyResponse);
}
